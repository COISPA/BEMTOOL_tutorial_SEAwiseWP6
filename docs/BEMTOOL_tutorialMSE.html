<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Isabella Bitetto (Fondazione COISPA)">
<meta name="dcterms.date" content="2025-09-11">

<title>SEAwise – BEMTOOL tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<!-- Load Font Awesome for social icons -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>

#header-links {

  margin: 1rem 0;

  display: flex;

  gap: 0.6rem;

}



#header-links a {

  display: inline-flex;

  align-items: center;

  padding: 0.4em 0.8em;

  border: 1px solid #ccc;

  border-radius: 5px;

  text-decoration: none;

  color: #333;

  background: #fff;

  font-size: 0.95em;

  transition: all 0.2s;

}



#header-links a:hover {

  background: #f5f5f5;

}



#header-links img {

  margin-right: 6px;

}

</style>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style>
  :root { --bs-body-font-size: 1.125rem; }  /* ≈ 18px se base 16px */
  #TOC, nav#toc { font-size: 0.95rem; }
  h1.title { display: none; }
  .title-row{ display:flex; align-items:center; justify-content:space-between; gap:1rem; margin:.5rem 0 1rem; }
  .title-row h1{ margin:0; font-size:2.2rem; line-height:1.1; color: var(--bs-heading-color, #0b7285); }
  .title-row img{ height:96px; }
  @media (max-width:576px){ .title-row{ flex-direction:column; align-items:flex-start; } .title-row img{ height:64px; } }
</style>


<link rel="stylesheet" href="styles-quarto.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./pics/SeaWiseFinal-01.png" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./BEMTOOL_tutorialMSE.html" aria-current="page"> 
<span class="menu-text">SEAwise – BEMTOOL tutorial</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://seawiseproject.org/"> 
<span class="menu-text">SEAwise Website</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ices-tools-dev/SEAwise"> 
<span class="menu-text">SEAwise Github</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Index</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#application-of-bemtool-in-wp6" id="toc-application-of-bemtool-in-wp6" class="nav-link" data-scroll-target="#application-of-bemtool-in-wp6">Application of BEMTOOL in WP6</a></li>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link" data-scroll-target="#required-packages">Required packages</a></li>
  <li><a href="#rgtk2-installation" id="toc-rgtk2-installation" class="nav-link" data-scroll-target="#rgtk2-installation">RGtk2 installation</a></li>
  <li><a href="#launching-the-model-and-running-the-simulation-part-from-the-gui" id="toc-launching-the-model-and-running-the-simulation-part-from-the-gui" class="nav-link" data-scroll-target="#launching-the-model-and-running-the-simulation-part-from-the-gui">Launching the model and running the simulation part from the GUI</a>
  <ul>
  <li><a href="#key-indicators-hindcast" id="toc-key-indicators-hindcast" class="nav-link" data-scroll-target="#key-indicators-hindcast">Key Indicators (hindcast)</a></li>
  </ul></li>
  <li><a href="#comparison-with-the-stock-assessment-results" id="toc-comparison-with-the-stock-assessment-results" class="nav-link" data-scroll-target="#comparison-with-the-stock-assessment-results">Comparison with the stock assessment results</a>
  <ul>
  <li><a href="#running-forecast" id="toc-running-forecast" class="nav-link" data-scroll-target="#running-forecast">Running forecast</a></li>
  <li><a href="#how-to-integrate-climate-change-through-emsrr" id="toc-how-to-integrate-climate-change-through-emsrr" class="nav-link" data-scroll-target="#how-to-integrate-climate-change-through-emsrr">How to integrate climate change through EMSRR</a></li>
  </ul></li>
  <li><a href="#modify-rfss-script-with-the-coefficients-of-the-emsrr" id="toc-modify-rfss-script-with-the-coefficients-of-the-emsrr" class="nav-link" data-scroll-target="#modify-rfss-script-with-the-coefficients-of-the-emsrr">Modify RFSS script with the coefficients of the EMSRR</a></li>
  <li><a href="#running-the-climate-change-scenarios" id="toc-running-the-climate-change-scenarios" class="nav-link" data-scroll-target="#running-the-climate-change-scenarios">Running the climate change scenarios</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SEAwise – BEMTOOL tutorial</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Isabella Bitetto (Fondazione COISPA) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div style="text-align:center; margin:8px 0 12px;">
<p><img src="seawise_logo_fullcolour.png" alt="SEAwise logo" style="height:300px;"></p>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>BEMTOOL is an integrated bioeconomic modelling tool that follows a multi-fleet and multiple species approach, simulating the effects of management scenarios on stocks and fisheries (<a href="https://www.sciencedirect.com/science/article/abs/pii/S0308597X1400298X">Rossetto et al.&nbsp;(2015)</a> and <a href="https://cdnsciencepub.com/doi/10.1139/cjfas-2024-0382">Bitetto et al.(2025)</a>). Such effects in mixed fisheries are measured by a suite of indicators with associated uncertainty. BEMTOOL was previously implemented, within FAIRSEA project (https://www.italy-croatia.eu/web/fairsea), in the Adriatic and western Ionian Seas (GFCM Geographical Sub Areas - GSAs 17, 18 and 19, Figure 1) to inform and support the modelling of indicators, targets and limits, linked to the management of key stocks: European hake (HKE), red mullet (MUT) and deep water rose shrimp (DPS).</p>
<p>The data required are for the most part publicly available and are mainly stock assessment results, transversal data (e.g.&nbsp;effort, landing), socio-economic data, other relevant information (e.g.&nbsp;historical management measures applied).</p>
<p>BEMTOOL model has been peer-reviewed in a number of contexts, through a number of applications in Mediterranean Sea under EU funded projects and STECF experts Working groups, including the <a href="https://stecf.ec.europa.eu/reports/management-plans_en">Western Med MAP STECF EWGs</a> where BEMTOOL is routinely applied since 2019. The tool was used also in the communication with relevant stakeholders in many contexts.</p>
<p align="center">
<img src="map.png" width="60%">
</p>
<p>In SEAwise the model has been enhanced covering 24 fleet segments, that which encompass both active and passive gears targeting demersal resources, and 10 key target stocks: European hake in GSAs 17-18, European hake in GSA 19, Red mullet in GSAs 17-18, Red mullet in GSA 19, Deep-water rose shrimp in GSAs 17-18-19, Common sole in GSA 17, Norway lobster in GSA 17, Norway lobster in GSA 18, giant red shrimp in GSAs 18-19 and blue and red shrimp in GSAs 18-19. These stocks are among the main target of the fisheries and of the Multi Annual Management Plan in the Adriatic region (GFCM Recommendations GFCM/43/2019/5; GFCM/44/2021/1). In the GSA19 a MAP for demersal stocks is not yet in place. However, considering the possible connectivity of the populations in the whole area (<a href="https://doi.org/10.2926/909535">Spedicato et al.&nbsp;(2022)</a>) also HKE and MUT in GSA19 were included in this analysis.</p>
</section>
<section id="application-of-bemtool-in-wp6" class="level1">
<h1>Application of BEMTOOL in WP6</h1>
<p>In SEAwise WP6 BEMTOOL model has been applied including enhancements made in WP2 (socio-economic impacts of and on fishing) and WP3 (Ecological effects on fisheries) and, specifically:</p>
<ol type="1">
<li>enhanced fish price sub-models and variable costs (e.g fuel) disaggregated by metier (see <a href="https://seawiseproject.org/open_online_course/modelling_social_economic_effects/">tutorial task 2.2</a>);</li>
<li>environmentally-mediated stock recruitment relationships (EMSRR), allowing to model effects of climate change on stock productivity (see <a href="https://github.com/ices-tools-dev/SEAwise_ecoMSE/tree/main/recruitment">tutorial on recruitment EMSRR estimation</a>.</li>
</ol>
<p>The climate change has been then combined with the a number of management measures, focused on effort control measures aligned with GFCM Multiannual Plans, including status quo effort, effort reduction to reach FMSY or F0.1, and multi-species PGY strategies. Additionally, management measures such as gear selectivity improvements, spatial closures and (e.g., reallocation of effort between static and mobile gears) were explored to assess their implications on economic performance, employment, and carbon emissions.</p>
<p>In the BEMTOOL operating model, the population dynamic is simulated by Aladym model (<a href="https://www.alr-journal.org/articles/alr/pdf/2009/02/alr006-09.pdf">Lembo et al.(2009)</a>) for all the stocks considered without interaction among them. The model at present can be considered a short-cut of type 1, with an estimation emulator that add error to the simulated population outcomes. Different sources of uncertainty can be included a part of recruitment: on sexual maturity, growth, M (linked to the growth), fleet selectivity. The model works by sex and month and includes length information of the population. A number of management scenarios can be simulated, including gear selectivity, spatio-temporal closures, catch limits and combinations of the measures. A number of indicators are provided, in particular the model estimates biological, pressure and socio-economic indicators and provide a number of alternative economic sub-models on price and costs to estimate properly the relevant economic performance by fleet.</p>
<p align="center">
<img src="BMT_scheme.png" width="80%">
</p>
</section>
<section id="required-packages" class="level1">
<h1>Required packages</h1>
<p>In order to run BEMTOOL you should have the following packages installed:</p>
<p>from zip: ALADYMTools (available on WP6 github)</p>
<p>from Cran:gridExtra, akima, stringr, Hmisc, timeDate,reshape, scales, FLBRP</p>
<p>from http://flrproject.org/R: FLCore, ggplot2, FLasher</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># iterators</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"iterators"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"iterators"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"FLCore"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#install.packages("FLCore",repos="http://flrproject.org/R")</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"flr/FLCore"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"ggplot2"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"gridExtra"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"akima"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"akima"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"stringr"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"stringr"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"RGtk2"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"RGtk2"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"Hmisc"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"Hmisc"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"timeDate"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"timeDate"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"reshape"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"reshape"</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"scales"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"scales"</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"tryCatchLog"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"tryCatchLog"</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"FLasher"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"FLasher"</span>,<span class="at">repos=</span><span class="st">"http://flrproject.org/R"</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"FLBRP"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>   <span class="co"># install.packages("FLBRP",repos="http://flrproject.org/R")</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"flr/FLBRP"</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"FLasher"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>])) {</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>   <span class="co"># install.packages("FLBRP",repos="http://flrproject.org/R")</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"flr/FLasher"</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rgtk2-installation" class="level1">
<h1>RGtk2 installation</h1>
<p>A specific procedure has to be carried out to install RGtk2:</p>
<ol type="1">
<li>Download GTK+ dependencies (gtk+-bundle_2.22.1-20101229_win64.zip file) from https://download.gnome.org/binaries/win64/gtk+/2.22/</li>
<li>Unzip it to the path of your choice.</li>
</ol>
<p>ATTENTION!!!!: Using either Windows Explorer’s built-in zip file management, or the command-line unzip.exe, available for instance at ftp://tug.ctan.org/tex-archive/tools/zip/info-zip/WIN32/unz552xN.exe unzip this bundle. Avoid Winzip! It is known to behave oddly.</p>
<ol start="3" type="1">
<li><p>Set the environment variable PATH to where GTK+ was unzipped. You could use this command from within R: Sys.setenv(PATH = “Path\to\gtk+”)</p></li>
<li><p>Install RGtk2 from Togaware:</p></li>
</ol>
<p>install.packages(“https://access.togaware.com/RGtk2_2.20.36.2.zip”, repos=NULL) or from Github:</p>
<p>devtools::install_github(“cran/RGtk2”)</p>
<ol start="5" type="1">
<li>Import the library:</li>
</ol>
<p>library(RGtk2)</p>
<ol start="6" type="1">
<li><p>A dialog window may appear asking you to intall GTK+. This should install some missing parts of the GTK+ or refer RGtk2 of the GTK+ installed in step 1.</p></li>
<li><p>Restart R.</p></li>
<li><p>Import the library again</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TO DO just the FIRST time you run BEMTOOL!</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#wd &lt;- "\\gtk+-bundle_2.22.1-20101229_win64"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd(wd)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.setenv(PATH = "C:\\Training\\gtk+-bundle_2.22.1-20101229_win64")</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("https://access.togaware.com/RGtk2_2.20.36.2.zip", repos=NULL)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RGtk2)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ALADYMTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="launching-the-model-and-running-the-simulation-part-from-the-gui" class="level1">
<h1>Launching the model and running the simulation part from the GUI</h1>
<p>Pay attention to copy on C disk the folder Training as it is.</p>
<p>Then copy in the console the code below, updating your working directory path.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="st">"C:</span><span class="sc">\\</span><span class="st">Training</span><span class="sc">\\</span><span class="st">BMT_Nov2024"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(wd)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#source("BEMTOOL.r")</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># activate_main_w()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>When BEMTOOL GUI will appears, click on “LOAD case study definition” button and select the file “INPUT/bmtconfigSimulation.csv”;</li>
</ol>
<p align="center">
<img src="Immagine1GUI.png" width="80%">
</p>
<ol start="2" type="1">
<li><p>Click on NEXT button and verify that all the data (biological, economic, etc…) are correctly read; click 3 times on NEXT and finally click on “RUN new diagnosis”;</p></li>
<li><p>When the ALADYM GUI appears, click on “Load simulation parameters” and select the file “INPUT/ALADYM/configuration file_ALADYM -HKE GSA 17-18.csv” and then click on RUN simulation.</p></li>
</ol>
<p align="center">
<img src="aladym_GUI.png" width="80%">
</p>
<ol start="4" type="1">
<li><p>In the console you can see the steps of running the reference points for stock 1; when it finishes, the ALADYM GUI for the second stock (hake 19) will appear. Redo the step 3, selecting in the following order these files:</p>
<ul>
<li>INPUT/ALADYM/configuration file_ALADYM -HKE GSA 19.csv;</li>
<li>INPUT/ALADYM/configuration file_ALADYM -MUT GSA 17-18.csv;</li>
<li>INPUT/ALADYM/configuration file_ALADYM -MUT GSA 19.csv;</li>
<li>INPUT/ALADYM/configuration file_ALADYM -DPS GSA 171819.csv.</li>
</ul></li>
</ol>
<p>At the end of this process, the diagnosis (current situation of the stocks and fisheries) is available in the GUI for your consultation.</p>
<section id="key-indicators-hindcast" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-hindcast">Key Indicators (hindcast)</h2>
<p>Once that the diagnosis is complete, the key indicators are stored in the OUTPUT folder (automatically created):</p>
<ul>
<li>Biological indicators (e.g.&nbsp;SSB, mean age population, mean age spawners, etc…) : Training - Biological Indicators.csv;</li>
<li>Economic indicators (e.g.&nbsp;GVA, costs, etc…): Training - Economic output.csv;</li>
<li>Pressure indicators (e.g.&nbsp;Catch, F, etc…): Training - Pressure impact indicators.csv</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">head</span>(<span class="fu">read.table</span>(<span class="st">"Training - Biological indicators.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>, <span class="at">header=</span><span class="cn">TRUE</span>))[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df, <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">position =</span> <span class="st">"center"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"bordered"</span>, <span class="st">"bordered"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-bordered caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Scenario</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ID_scenario</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Fleet_segment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Stock</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Unit</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="6" style="text-align: left; vertical-align: top !important;">Diagnosis</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">Bref</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">BF0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">SSBref</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SSBF0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">SSB_exploited_pop</td>
<td style="text-align: left;">3374.73</td>
<td style="text-align: left;">tons</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">Total_biomass_exploited_pop</td>
<td style="text-align: left;">16079.16</td>
<td style="text-align: left;">tons</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">SSB_SSBref</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SSB_SSBF0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">SSB_unexploited_pop</td>
<td style="text-align: left;">22579.15</td>
<td style="text-align: left;">tons</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">head</span>(<span class="fu">read.table</span>(<span class="st">"Training - Economic output.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>, <span class="at">header=</span><span class="cn">TRUE</span>))[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df, <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">position =</span> <span class="st">"center"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"bordered"</span>, <span class="st">"bordered"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-bordered caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Scenario</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ID_scenario</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Fleet_segment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Species</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Unit</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="6" style="text-align: left; vertical-align: top !important;">Diagnosis</td>
<td style="text-align: left;">Diagnosis--</td>
<td style="text-align: left;">Fleet1</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">VESSELS.annual</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">number</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Diagnosis--</td>
<td style="text-align: left;">Fleet1</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">GT.average.annual</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">GT</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diagnosis--</td>
<td style="text-align: left;">Fleet1</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">GT.annual</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">GT</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Diagnosis--</td>
<td style="text-align: left;">Fleet1</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">KW.average.annual</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">KW</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diagnosis--</td>
<td style="text-align: left;">Fleet1</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">KW.annual</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">KW</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Diagnosis--</td>
<td style="text-align: left;">Fleet1</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">DAYS.average.annual</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">days</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">head</span>(<span class="fu">read.table</span>(<span class="st">"Training - Biological indicators.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>, <span class="at">header=</span><span class="cn">TRUE</span>))[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df, <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">position =</span> <span class="st">"center"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"bordered"</span>, <span class="st">"bordered"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-bordered caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Scenario</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ID_scenario</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Fleet_segment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Stock</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Unit</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="6" style="text-align: left; vertical-align: top !important;">Diagnosis</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">Bref</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">BF0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">SSBref</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SSBF0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">SSB_exploited_pop</td>
<td style="text-align: left;">3374.73</td>
<td style="text-align: left;">tons</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">Total_biomass_exploited_pop</td>
<td style="text-align: left;">16079.16</td>
<td style="text-align: left;">tons</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">SSB_SSBref</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SSB_SSBF0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">M.mer1718</td>
<td style="text-align: left;">1998</td>
<td style="text-align: left;">SSB_unexploited_pop</td>
<td style="text-align: left;">22579.15</td>
<td style="text-align: left;">tons</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="comparison-with-the-stock-assessment-results" class="level1">
<h1>Comparison with the stock assessment results</h1>
<p>BEMTOOL utilises the main stock assessment input and results to replicate the stocks by month.</p>
<p>To create a BEMTOOL application from scratch refer to the script available at: https://github.com/Isabella84/BEMTOOL2.5/tree/master (script for BEMTOOL parameterization).</p>
<p>The first step for completing the conditioning of the model is to compare the stock assessment results, in terms of SSB, F and catch, with the same indicators derived from the stocks replicated by BEMTOOL using the stock assessment results.</p>
<p>Some examples of comparison follow:</p>
<p align="center">
<img src="DPS171819-hindcasting.jpeg" width="90%">
</p>
<div style="text-align:center; font-weight:300; margin-bottom:0.5rem;">
<p>Figure 2 - Example of stock replicated from SPiCT stock assessment results</p>
</div>
<p align="center">
<img src="HKE1718_hindcasting.jpeg" width="90%">
</p>
<div style="text-align:center; font-weight:300; margin-bottom:0.5rem;">
<p>Figure 3 - Example of stock replicated from SS3 stock assessment results</p>
</div>
<section id="running-forecast" class="level2">
<h2 class="anchored" data-anchor-id="running-forecast">Running forecast</h2>
<p>Once that the diagnosis was loaded, click on “Load scenario configuration” and select the file bmtconfigForecast.csv. It is set a SQ scenario.</p>
<p>To parameterize all the economic functions in the projections, refer to the <a href="https://github.com/ices-tools-dev/SEAwise_ecoMSE/blob/main/BEMTOOL/BEMTOOL%202%200%20-%20User%20Handbook_29052015_DRAFT.pdf">BEMTOOL manual</a>. Consider that the for parameterizing the fish price functions and the variable costs, a dedicated tutorial was developed <a href="https://coispa.github.io/Fish-price-and-variable-costs/Enhanced_fishprice_fuelcosts_submodels.html">SEAwise – Fish price &amp; Variable costs</a>.</p>
<p>Several management strategies can be simulated in BEMTOOL, also in combination with the impact of climate change on recruitment:</p>
<ul>
<li>Change in Selectivity: after selecting Change in selectivity scenario (or combining change in selectivity with other scenarios) from the GUI or from the bmfconfig csv file, we could change the selectivity in the ALADYM GUI, each time that a species GUI will open. An example of selectivity file is provided in the github Med case study repository, under BEMTOOL directory. See also chapter 12.1 of the manual for further details.</li>
</ul>
<p align="center">
<img src="selectivity.png" width="90%">
</p>
<ul>
<li>Change in effort: the change in effort has to be parameterized providing in the BEMTOOL GUI the cvs file for the number of vessels and the number of fishing days by month and year. The GT and KW for the fleets are assumed the same of the last year of simulation. An example of fishing day and vessel file is provided in the github Med case study repository, under BEMTOOL directory. The change in effort can be also parameterised using the GUI (see chapter 12.2), through a smart facility.</li>
</ul>
<p align="center">
<img src="smartGUI.png" width="90%">
</p>
</section>
<section id="how-to-integrate-climate-change-through-emsrr" class="level2">
<h2 class="anchored" data-anchor-id="how-to-integrate-climate-change-through-emsrr">How to integrate climate change through EMSRR</h2>
<p>To integrate the environmental variables, and then the climate, on the stock recruitment relationships and in the projections, SEAwise BEMTOOL model built on the work made in WP3, described in <a href="https://cdnsciencepub.com/doi/10.1139/cjfas-2024-0382">Bitetto et al.(2025)</a>.</p>
<p>Before clicking on Run NEW scenario, select the grid for environmental projections for the years of simulations (in our case until 2040) from the GUI. Open the script “runCI.r” in the folder (lines 628-650):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#"C:\Training\BMT_Nov2024\src\biol\bmtALADYM\ALADYM-ver12.3-2017_0501\src" </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This modification of the files will change according to the climate change scenario.Below an example without clmate change:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DO IT in the script, here it is reported only an example!</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Folder: "C:\Training\BMT_Nov2024\src\biol\bmtALADYM\ALADYM-ver12.3-2017_0501\src"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>BMT_SPECIES<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"M.mer1718"</span> ,  <span class="st">"M.mer19"</span>    , <span class="st">"M.bar1718"</span>   ,<span class="st">"M.bar19"</span>   ,  <span class="st">"P.lon171819"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>ALADYM_spe<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.mer1718"</span> ){</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  ENV<span class="ot">&lt;&lt;-</span><span class="fu">read.table</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Training</span><span class="sc">\\</span><span class="st">INPUT</span><span class="sc">\\</span><span class="st">ENVIRONMENTAL_GRIDS</span><span class="sc">\\</span><span class="st">HKE1718_50_500_NoCC_bia_adj_month.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>,<span class="at">header=</span>T)  </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.mer19"</span> ){</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  ENV<span class="ot">&lt;&lt;-</span><span class="fu">read.table</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Training</span><span class="sc">\\</span><span class="st">INPUT</span><span class="sc">\\</span><span class="st">ENVIRONMENTAL_GRIDS</span><span class="sc">\\</span><span class="st">HKE19_50_500_NoCC_bia_adj_month_2.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>,<span class="at">header=</span>T)  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.bar1718"</span> ){</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  ENV<span class="ot">&lt;&lt;-</span><span class="fu">read.table</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Training</span><span class="sc">\\</span><span class="st">INPUT</span><span class="sc">\\</span><span class="st">ENVIRONMENTAL_GRIDS</span><span class="sc">\\</span><span class="st">MUT1718_10-200_NoCC_bia_adj_month.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>,<span class="at">header=</span>T)  </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.bar19"</span> ){</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  ENV<span class="ot">&lt;&lt;-</span><span class="fu">read.table</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Training</span><span class="sc">\\</span><span class="st">INPUT</span><span class="sc">\\</span><span class="st">ENVIRONMENTAL_GRIDS</span><span class="sc">\\</span><span class="st">MUT19_10_200_NoCC_bia_adj_month.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>,<span class="at">header=</span>T)  </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"P.lon171819"</span> ){</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  ENV<span class="ot">&lt;&lt;-</span><span class="fu">read.table</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Training</span><span class="sc">\\</span><span class="st">INPUT</span><span class="sc">\\</span><span class="st">ENVIRONMENTAL_GRIDS</span><span class="sc">\\</span><span class="st">DPS17181920_50_500_NoCC_bia_adj_month.csv"</span>,<span class="at">sep=</span><span class="st">";"</span>,<span class="at">header=</span>T)  </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ENV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["YEAR"],"name":[1],"type":["int"],"align":["right"]},{"label":["MONTH"],"name":[2],"type":["int"],"align":["right"]},{"label":["sst"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["botT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["nppv"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"2023","2":"1","3":"18.79447","4":"14.50963","5":"2.325654","_rn_":"1"},{"1":"2023","2":"2","3":"18.79447","4":"14.50963","5":"1.522352","_rn_":"2"},{"1":"2023","2":"3","3":"18.79447","4":"14.50963","5":"-11.902670","_rn_":"3"},{"1":"2023","2":"4","3":"18.79447","4":"14.50963","5":"13.631010","_rn_":"4"},{"1":"2023","2":"5","3":"18.79447","4":"14.50963","5":"40.598707","_rn_":"5"},{"1":"2023","2":"6","3":"18.79447","4":"14.50963","5":"18.659600","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This table could potentially contain different values for each month in the year.</p>
</section>
</section>
<section id="modify-rfss-script-with-the-coefficients-of-the-emsrr" class="level1">
<h1>Modify RFSS script with the coefficients of the EMSRR</h1>
<p>In the function containing the equations of the SRR, we included all the coefficients by stock except a and b (that are in the grid defined above).</p>
<p>For the estimation of the EMSRR coefficients on your own data, refer to the <a href="https://github.com/ices-tools-dev/SEAwise_ecoMSE/tree/main/recruitment">WP3 tutorial</a>.</p>
<p>Folder: path reported in the code below.</p>
<p>These coefficients will not change with the climate change scenario.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DO IT in the script!! Here there is only an example!</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Folder: "C:\Training\BMT_Nov2024\src\biol\bmtALADYM\ALADYM-ver12.3-2017_0501\src"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.mer1718"</span> ){</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>para_RLc<span class="ot">=</span><span class="fl">0.123</span>  <span class="co"># HKE 1718</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>para_RLd<span class="ot">=</span><span class="dv">0</span>  <span class="co"># HKE 1718</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.mer19"</span>){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>para_RLc<span class="ot">=</span><span class="fl">0.244</span>      <span class="co"># HKE19</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>para_RLd<span class="ot">=</span> <span class="dv">0</span>     <span class="co"># HKE19</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.bar1718"</span>){</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>para_RLc<span class="ot">=</span><span class="fl">0.395</span>      <span class="co"># mut1718</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>para_RLd<span class="ot">=</span>  <span class="fl">0.014</span>    <span class="co"># mut1718</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"M.bar19"</span>){</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>para_RLc<span class="ot">=</span><span class="fl">0.546</span>      <span class="co"># mut19</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>para_RLd<span class="ot">=</span>  <span class="dv">0</span>   <span class="co"># mut19</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (BMT_SPECIES[ALADYM_spe]<span class="sc">==</span><span class="st">"P.lon171819"</span>){</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>para_RLc<span class="ot">=</span><span class="dv">0</span>      <span class="co"># dps</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>para_RLd<span class="ot">=</span>  <span class="sc">-</span><span class="fl">0.424</span>   <span class="co"># dps</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-the-climate-change-scenarios" class="level1">
<h1>Running the climate change scenarios</h1>
<p>Come back to the BEMTOOL GUI and, clicking on “Load scenario configuration” button, you can select the file “INPUT/bmtconfigForecast.csv”.</p>
<p>In the GUI can verify if the input data are correctly read, and you can modify the name of the scenario according to the setting defined in the chunk “modify the RCP scenario”.</p>
<p>In the OUTPUT folder you will find all your saved results, in tables (.csv) and plots.</p>
<p align="center">
<img src="screeshot.png" width="90%">
</p>
<p>Examples of comparison among scenarios follow:</p>
<p align="center">
<img src="Fig_4.png" width="90%">
</p>
<div style="text-align:center; font-weight:300; margin-bottom:0.5rem;">
<p>Figure 4 - Example of comparison for European hake in Adriatic and western Ionian Sea comparing dfferent climate scenarios under Fmsy management.</p>
</div>
<p align="center">
<img src="Fig_5.png" width="90%">
</p>
<div style="text-align:center; font-weight:300; margin-bottom:0.5rem;">
<p>Figure 5 - Example of comparison for Deep-water rose shrimp in Adriatic and Ionian Sea comparing dfferent climate scenarios under Fmsy management.</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>